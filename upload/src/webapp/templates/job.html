{% extends 'base.html' %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='job.css') }}">
{% endblock %}

{% block title %}Job {{ job_hash }} - CircuiTree{% endblock %}

{% block content %}
<div class="job-page">
    <div class="header">
        <h1>Job: {{ filename }}</h1>
        <p>Submitted by: <strong>{{ username }}</strong></p>
        <p>Status: <span id="status" class="status-badge {{ status }}">{{ status }}</span></p>
        <p>Hash: <code>{{ job_hash }}</code></p>
    </div>

    <div class="output-section">
        <h2>Output</h2>
        <pre id="output">{{ output if output else 'No output yet...' }}</pre>
    </div>

    <div class="actions">
        <a href="{{ url_for('queue.monitor') }}" class="btn">View Queue</a>
        <a href="{{ url_for('editor.editor_view') }}" class="btn">Write New Code</a>
    </div>
</div>

<script>
    const pollInterval = setInterval(() => {
        fetch('/api/job/{{ job_hash }}')
            .then(r => r.json())
            .then(data => {
                document.getElementById('status').textContent = data.status;
                document.getElementById('status').className = 'status-badge ' + data.status;
                document.getElementById('output').textContent = data.output || 'No output yet...';
                
                // Stop polling if job is completed or failed
                if (data.status === 'completed' || data.status === 'failed') {
                    clearInterval(pollInterval);
                }
            });
    }, 2000);
</script>
{% endblock %}