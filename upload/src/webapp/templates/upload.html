<!-- filepath: /home/boyan/Projects/uni/circuitree/tree/upload/src/webapp/templates/upload.html -->
{% extends 'base.html' %}

{%block head%}
    <link rel="stylesheet" href="{{ url_for('static', filename='upload.css') }}">
{% endblock %}

{% block content %}
<div class="content" id="dropZone">
<h1>Upload your code!</h1>
<form action="/upload" method="post" enctype="multipart/form-data" id="uploadForm">
    <div class="form-container">
        <input type="text" id="username" name="username" placeholder="Enter your username" required>
        <span id="file-name"></span>
        <div class="button-group">
            <label for="file" class="file-label">Choose File</label>
            <input type="file" id="file" name="file" required>
            <button type="button" id="cancelBtn" class="cancel-btn" style="display: none;">Cancel</button>
            <input type="submit" value="Upload" id="uploadBtn">
        </div>
    </div>
    {% if message %}
        <p id="{{ code }}" class = "msg">{{ message }}</p>
        <p class="msg"> Redirecting to {{redirect_to}} in 5 seconds...</p>
        <script>
            setTimeout(function(){
                window.location.href = "{{ redirect_to }}";
            }, 5000);
        </script>
    {% endif %}
</form>
<div id="dropOverlay"></div>
<script>
    const fileInput = document.getElementById('file');
    const dropZone = document.getElementById('dropZone');
    const dropOverlay = document.getElementById('dropOverlay');
    const fileName = document.getElementById('file-name');
    const cancelBtn = document.getElementById('cancelBtn');

    fileInput.addEventListener('change', function(e) {
        if (e.target.files[0]) {
            fileName.textContent = e.target.files[0].name;
            cancelBtn.style.display = 'inline-block';
        }
    });

    cancelBtn.addEventListener('click', function() {
        fileInput.value = '';
        fileName.textContent = '';
        cancelBtn.style.display = 'none';
    });

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => {
            dropOverlay.classList.add('active');
        }, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => {
            dropOverlay.classList.remove('active');
        }, false);
    });

    dropZone.addEventListener('drop', function(e) {
        const dt = e.dataTransfer;
        const files = dt.files;

        if (files.length > 0) {
            fileInput.files = files;
            fileName.textContent = files[0].name;
            cancelBtn.style.display = 'inline-block';
        }
    });
</script>
</div>
{% include "help.html" %}

{% endblock %}